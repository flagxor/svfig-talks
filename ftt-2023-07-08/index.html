<!DOCTYPE html>
<script src="../websent/websent.js"></script><script>
FONT = 'consolas; courier';
USABLE = 0.9;
LINE_SPACING = 1.2;
BACKGROUND = '#eeffee';
FOREGROUND = '#004400';
</script><pre>

Dividing ESP32forth
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   July 8, 2023

 ESP32forth is
ğŸ”¥ TOO BIG! ğŸ¤¬

What happened?

ğŸ’¡ Some OLED module
ğŸ“· ESP32-CAM â‡’ camera bindings
ğŸ¦† 32-bit floating point
ğŸ¥£ Serial and Serial2
ğŸ¦· Bluetooth Serial
ğŸ¢ Structures

ğŸ“ Files + SPIFFS
ğŸ§± Blocks
â° Timers
ğŸ”Œ Sockets
ğŸ“¶ WiFi
â›” Fault Handling

ğŸ— Visual Editor
âš  Interrupts
ğŸ…Œ SD / SD_MMC Cards
â§ I2C
âœ£ Heap management
âƒ LEDC

Even more outside ESP32!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ—” Windows API bindings
 â•³ X11 API bindings
âŒ’  Graphics and Bezier curves
ğŸ§µ Threads

Root Causes
â•â•â•â•â•â•â•â•â•â•â•
â˜‰ Different applications want
   different APIs / bindings
â˜‰ It's easier to ship one big release
â˜‰ It's easier to add than remove/refactor

How Big is too Big?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ Should a Forth have DO..LOOP
   (or is FOR..NEXT enough) ?
â˜‰ What about VALUE TO ?
â˜‰ What about { locals } ?
â˜‰ Structures ?
â˜‰ Tasks ?
â˜‰ Graphics ?

ESP32 Resources are Weird
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ RAM is more scarce than Flash
   - So words defined in Forth are more expensive
   - So changable things are more expensive
â˜‰ C Libraries can be huge (Bluetooth)
â˜‰ Contiguous RAM varies by model

How to limit growth?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ Size of your ROM? (Jupiter ACE)
â˜‰ What's in the standard? (Gforth)
â˜‰ What limit? (Win32Forth)

What has helped?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ Clearer hooks for expansion (userwords.h)
â˜‰ People complaining it won't fit / build!
â˜‰ Files for Linux + Windows

userwords.h
â•â•â•â•â•â•â•â•â•â•â•
int my_cool_function(char *foo, int bar, uint8_t *baz);
#define USER_WORDS \
  Y(MY_FUNC, n0 = my_cool_function(c2, n1, b0); NIPn(2)) \

Using Files more with ESP32forth?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ Many extensions are more about C libraries
â˜‰ How to get things on/off the device?
   - ESP32forth isn't always on the network
   - putty etc. don't have X-Modem or the like
â˜‰ I actually use files with SD card devices
   (e.g. ESP32-CAM)

A Stab in the Dark
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ Break apart ESP32forth.ino
â˜‰ Carve off less used modules placing them
   in the optional/ directory in the distribution zip
â˜‰ Use __has_include("name.h") to load if moved
   next to ESP32forth.ino
â˜‰ Iterate with the user community
   on which modules should be optional
â˜‰ Maybe some should be optionally removable?

The Initial Optionals
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ assemblers.h - The assemblers for Xtensa + RISC-V
                  (not widely used/useful,
                   poorly documented/tested)
â˜‰ camera.h - ESP32-CAM / OV2640
              (specific hardware,
               inaccurate detection of board)
â˜‰ oled.h - Adafruit SSD1306 OLED support
            (specific hardware,
             not relevant to everyone)
â˜‰ serial-bluetooth.h - Serial Bluetooth
                        + Bluetooth Terminal
                        (really big flash footprint)
â˜‰ spi-flash.h - Low level SPI flash partition access
                 (not relevant to most users)

ESP32forth.zip
â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ESP32forth/
  README.txt
  ESP32forth.ino
  optional/
    README-optional.txt
    assemblers.h
    camera.h
    oled.h
    serial-bluetooth.h
    spi-flash.h

Potential Future Candidates?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â˜‰ LEDC support
â˜‰ FreeRTOS Tasks
â˜‰ GPIO interrupt triggers
â˜‰ Timers
â˜‰ RMT - Remote Control
â˜‰ Sockets / Web Server
â˜‰ Files / Block
â˜‰ Editors
â˜‰ I2C / Wire
â˜‰ Floating Point

Discussion
â•â•â•â•â•â•â•â•â•â•
â˜‰ Are any of these a mistake?
â˜‰ What else to leave out?
â˜‰ Is there a good general principle?

QUESTIONS?
    ğŸ˜•
 Thank you!
